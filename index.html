<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GLOBAL CASH TIME | Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #ffea00; --primary-dark: #ccac00; --bg: #050505; --card: #121212; --text: #ffffff; --green: #00ff66; --red: #ff3333; --link: #88ccff; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; overflow-x: hidden; position: relative; min-height: 100vh; }
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, #1a1500 0%, #050505 100%); z-index: -2; }
        .bg-glow { position: fixed; width: 100vw; height: 100vh; z-index: -1; top: 0; left: 0; pointer-events: none; }
        .particle { position: absolute; width: 2px; height: 15px; background: var(--primary); opacity: 0.2; animation: rain linear infinite; }
        @keyframes rain { 0% { transform: translateY(-100px); } 100% { transform: translateY(110vh); } }
        header { width: 100%; padding: 20px 0; background: rgba(18, 18, 18, 0.9); border-bottom: 2px solid var(--primary); text-align: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .main-container { width: 95%; max-width: 1200px; padding: 10px; box-sizing: border-box; flex-grow: 1; }
        button { background: linear-gradient(145deg, #fff200, #b8860b); color: #000; border: 1px solid #fff; padding: 12px; font-weight: 900; cursor: pointer; border-radius: 8px; font-size: 12px; text-transform: uppercase; transition: 0.3s; box-shadow: 0 0 10px rgba(255, 234, 0, 0.2); }
        .profile-card { display: none; background: linear-gradient(145deg, #1a1a1a, #0a0800); border: 2px solid var(--primary); padding: 15px; border-radius: 15px; margin: 0 auto 20px; width: 100%; max-width: 480px; box-sizing: border-box; }
        .label-gold { color: var(--primary); font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .section-box { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: center; border: 1px solid #222; }
        .salas-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 20px; }
        .sala-card { background: #0a0a0a; border: 1px solid #333; border-radius: 12px; padding: 8px; text-align: center; cursor: pointer; transition: 0.3s; }
        .sala-card.active { border-color: var(--primary); background: #2a2200; box-shadow: 0 0 15px rgba(255, 234, 0, 0.4); }
        .game-layout { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; align-items: flex-start; }
        .left-col { width: 320px; flex-shrink: 0; }
        .right-col { flex: 1; min-width: 300px; }
        #canvas-container { position: relative; margin: 0 auto; width: 300px; height: 300px; }
        #pointer { position: absolute; right: -5px; top: 50%; transform: translateY(-50%); width: 30px; height: 20px; background: #fff; clip-path: polygon(100% 0%, 0% 50%, 100% 100%); z-index: 10; }
        canvas { width: 300px !important; height: 300px !important; border-radius: 50%; border: 4px solid #222; }
        .numbers-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; background: #000; padding: 10px; border-radius: 8px; max-height: 400px; overflow-y: auto; }
        .num-btn { padding: 8px 0; font-size: 10px; border: 1px solid #333; background: #111; color: #fff; cursor: pointer; border-radius: 4px; }
        .num-btn.selected { background: var(--green); color: #000; font-weight: bold; }
        .num-btn.taken { background: var(--red) !important; color: #fff !important; cursor: not-allowed; pointer-events: none; }
        .btn-rand { background: #222; color: #fff; border: 1px solid #444; padding: 8px; font-size: 10px; flex: 1; text-transform: none; }
        .btn-rand b { color: var(--primary); display: block; font-size: 11px; }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; justify-content:center; align-items:center; }
        input, select { width: 90%; padding: 14px; margin: 10px 0; background: #000; color: #fff; border: 1px solid #444; border-radius: 8px; text-align: center; }
        .password-wrapper { position: relative; width: 90%; margin: 0 auto; }
        .eye-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #aaa; }
        .auth-links { margin-top: 15px; font-size: 12px; color: var(--link); cursor: pointer; text-decoration: underline; }
        footer { width: 100%; padding: 30px 0; background: #0a0a0a; border-top: 1px solid #222; text-align: center; color: #555; font-size: 12px; }
        @media (max-width: 768px) { .salas-grid { grid-template-columns: repeat(2, 1fr); } .left-col, .right-col { width: 100%; } }
    </style>
</head>
<body>
<div class="bg-glow" id="rain-container"></div>
<header>
    <div style="font-weight: 900; font-size: 26px; color: var(--primary);">üî±GLOBAL CASH TIMEüî±</div>
    <div id="guest-btn" style="margin-top:10px;"><button onclick="openM('auth')" style="width:auto; padding:8px 30px;">LOGIN / REGISTRO</button></div>
</header>
<div class="main-container">
    <div id="user-profile" class="profile-card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div><span class="label-gold">CUENTA</span><div id="prof-name" style="font-weight:900;">---</div></div>
            <div style="text-align:right;"><span class="label-gold">SALDO</span><div id="prof-balance" style="color:var(--green); font-weight:900; font-size:24px;">$0.00</div></div>
        </div>
        <div style="display:flex; gap:5px; margin-top:15px;">
            <button onclick="openM('dep')" style="flex:1;">DEPOSITAR</button>
            <button onclick="openM('with')" style="flex:1; background:var(--red); color:#fff;">RETIRAR</button>
            <button onclick="logout()" style="flex:1; background:#333; color:#fff;">SALIR</button>
        </div>
        <div id="admin-panel" style="display:none; margin-top:15px; border-top:1px solid #444; padding-top:10px;">
            <span class="label-gold">ADMINISTRACI√ìN</span>
            <div id="pending-deps" style="margin-top:10px;"></div>
        </div>
    </div>
    <div class="salas-grid" id="grid-salas"></div>
    <div class="section-box game-layout">
        <div class="left-col">
            <h3 id="sala-txt" style="color:var(--primary); margin:0;">SALA #1</h3>
            <div id="canvas-container"><div id="pointer"></div><canvas id="wheel" width="600" height="600"></canvas></div>
            <p id="prog-txt" style="font-weight:bold; margin:10px 0 5px;">0 / 200 Vendidos</p>
            <div id="live-counter" style="color:var(--green); font-size: 18px; font-weight: 900; height: 25px;"></div>
            <p id="status-txt" style="color:var(--primary); font-weight:bold; min-height:1.2em;"></p>
            <button id="buy-btn" onclick="comprarSeleccion()" style="width:100%; height:50px; margin:10px 0;">COMPRAR SELECCIONADOS</button>
            <div style="display:flex; gap:5px;">
                <button class="btn-rand" onclick="rand(5)"><b>5 Aleatorios</b>$2.50</button>
                <button class="btn-rand" onclick="rand(15)"><b>15 Aleatorios</b>$7.50</button>
                <button class="btn-rand" onclick="rand(25)"><b>25 Aleatorios</b>$12.50</button>
            </div>
        </div>
        <div class="right-col">
            <h4 style="margin:0 0 10px 0; color:var(--primary);">SELECCI√ìN MANUAL ($0.50)</h4>
            <div class="numbers-grid" id="num-selector"></div>
        </div>
    </div>
</div>
<footer>GLOBAL CASH TIME ¬© 2026</footer>
<div id="modal" class="modal"><div id="modal-content" class="section-box" style="width:90%; max-width:380px;"></div></div>

<script>
// CONFIGURACI√ìN OFICIAL
const firebaseConfig = {
  apiKey: "AIzaSyCntjKiPwfoCq0MzHIkybX4VZuYE_ZCnOE",
  authDomain: "globalcash-6fbe8.firebaseapp.com",
  databaseURL: "https://globalcash-6fbe8-default-rtdb.firebaseio.com",
  projectId: "globalcash-6fbe8",
  storageBucket: "globalcash-6fbe8.firebasestorage.app",
  messagingSenderId: "476476155798",
  appId: "1:476476155798:web:947a0e0140acfca78d5fb7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let currentU = null, sSel = 0, ang = 0, mySelection = [];
let salas = Array.from({length: 20}, (_, i) => ({ id: i+1, count: 0, sold: [], isSpinning: false, isWaiting: false, currentGiro: 0, endTime: 0, lastWinner: null }));
const wheelNumbers = Array.from({length: 200}, (_, i) => i + 1).sort(() => Math.random() - 0.5);

// ESCUCHA DE SESI√ìN Y DATOS
auth.onAuthStateChanged(user => {
    if (user) {
        db.ref('users/' + user.uid).on('value', snap => {
            currentU = snap.val();
            if(currentU) showProfile();
        });
    } else {
        document.getElementById('user-profile').style.display='none';
        document.getElementById('guest-btn').style.display='block';
    }
});

db.ref('salas').on('value', snap => { if(snap.val()) { salas = snap.val(); renderGrid(); renderNumbers(); } });

window.onload = () => { createRain(); draw(); setInterval(logic, 30); };

function logic() {
    const now = Date.now();
    let change = false;
    salas.forEach((s, i) => {
        if(s.isSpinning) {
            let timeLeft = s.endTime - now;
            if(timeLeft <= 0) {
                s.isSpinning = false; s.isWaiting = true; s.endTime = now + 5000;
                s.lastWinner = getWinningNumber();
                if(i === sSel) { confetti(); document.getElementById('live-counter').innerText = `¬°GANADOR: #${s.lastWinner}!`; }
                change = true;
            } else if(i === sSel) {
                let speed = 0.45;
                if ((15000 - timeLeft) > 10000) speed = Math.max(0.001, 0.45 * Math.pow(1 - ((15000 - timeLeft) - 10000) / 5000, 4));
                ang += speed; draw(); 
                document.getElementById('live-counter').innerText = `SORTEANDO: ${getWinningNumber()}`;
            }
        } else if(s.isWaiting && now >= s.endTime) {
            s.isWaiting = false;
            if(s.currentGiro < 3) { s.currentGiro++; s.isSpinning = true; s.endTime = now + 15000; }
            else { s.currentGiro = 0; s.count = 0; s.sold = []; s.lastWinner = null; }
            change = true;
        }
    });
    if(change) db.ref('salas').set(salas);
}

function getWinningNumber() {
    const normalizedAng = (ang % (Math.PI * 2) + (Math.PI * 2)) % (Math.PI * 2);
    return wheelNumbers[Math.floor(((Math.PI * 2 - normalizedAng) / (Math.PI * 2)) * 200) % 200];
}

function draw() {
    const canvas = document.getElementById('wheel'), ctx = canvas.getContext('2d'), colors = ['#3366FF', '#FF3333', '#FFCC00', '#009933'], arc = (Math.PI*2)/200;
    ctx.clearRect(0,0,600,600);
    for(let i=0; i<200; i++) {
        const a = ang + i*arc; ctx.beginPath(); ctx.fillStyle = colors[i%4]; ctx.moveTo(300,300); ctx.arc(300,300,300, a, a+arc); ctx.fill();
        ctx.save(); ctx.translate(300,300); ctx.rotate(a+arc/2); ctx.fillStyle="#fff"; ctx.font="bold 8px Arial"; ctx.fillText(wheelNumbers[i], 265, 0); ctx.restore();
    }
}

function openM(t) {
    const c = document.getElementById('modal-content'); document.getElementById('modal').style.display='flex';
    if(t==='auth') {
        c.innerHTML = `<h3>ACCESO</h3><input id="auth-e" placeholder="Correo"><div class="password-wrapper"><input id="auth-p" type="password" placeholder="Clave"><span class="eye-icon" onclick="togglePass('auth-p')">üëÅÔ∏è</span></div>
        <button onclick="login()" style="width:100%; margin-top:10px;">ENTRAR</button>
        <div class="auth-links" onclick="openM('reg')">Crear cuenta nueva</div>`;
    } else if(t==='reg') {
        c.innerHTML = `<h3>REGISTRO</h3><input id="reg-u" placeholder="Nombre de Usuario"><input id="reg-e" placeholder="Correo"><input id="reg-p" type="password" placeholder="Clave"><button onclick="register()" style="width:100%; margin-top:10px; background:var(--green)">REGISTRAR</button>
        <div class="auth-links" onclick="openM('auth')">Ya tengo cuenta</div>`;
    }
    c.innerHTML += `<button onclick="closeM()" style="background:#444; margin-top:10px; width:100%;">CERRAR</button>`;
}

function register() {
    const e = document.getElementById('reg-e').value, p = document.getElementById('reg-p').value, u = document.getElementById('reg-u').value;
    auth.createUserWithEmailAndPassword(e, p).then(res => {
        db.ref('users/' + res.user.uid).set({ u: u, b: 0, uid: res.user.uid });
        closeM();
    }).catch(err => alert(err.message));
}

function login() {
    const e = document.getElementById('auth-e').value, p = document.getElementById('auth-p').value;
    auth.signInWithEmailAndPassword(e, p).then(() => closeM()).catch(err => alert(err.message));
}

function logout() { auth.signOut().then(() => location.reload()); }
function showProfile() { document.getElementById('guest-btn').style.display='none'; document.getElementById('user-profile').style.display='block'; document.getElementById('prof-name').innerText = currentU.u; document.getElementById('prof-balance').innerText = `$${currentU.b.toFixed(2)}`; }
function togglePass(id) { const x = document.getElementById(id); x.type = x.type === 'password' ? 'text' : 'password'; }
function closeM() { document.getElementById('modal').style.display='none'; }
function renderGrid() { const g = document.getElementById('grid-salas'); g.innerHTML = ""; salas.forEach((s, i) => { g.innerHTML += `<div class="sala-card ${sSel===i?'active':''}" onclick="sSel=${i};renderGrid();renderNumbers();"><b>SALA ${s.id}</b><div>${s.count}/200</div></div>`; }); }
function renderNumbers() { const c = document.getElementById('num-selector'); c.innerHTML = ""; const s = salas[sSel]; let taken = s.sold.map(x => x.n); for(let n=1; n<=200; n++) { const isSold = taken.includes(n), isSel = mySelection.includes(n); c.innerHTML += `<button class="num-btn ${isSold?'taken':''} ${isSel?'selected':''}" onclick="${!isSold ? `toggleNum(${n})` : ''}">${n}</button>`; } document.getElementById('prog-txt').innerText = `${s.count} / 200 Vendidos`; }
function toggleNum(n) { if(mySelection.includes(n)) mySelection = mySelection.filter(x => x !== n); else mySelection.push(n); renderNumbers(); }
function comprarSeleccion() { 
    if(!currentU) return openM('auth'); 
    let s = salas[sSel], cost = mySelection.length * 0.5; 
    if(currentU.b >= cost && cost > 0) {
        db.ref('users/' + currentU.uid).update({ b: currentU.b - cost });
        mySelection.forEach(n => s.sold.push({n, u: currentU.u}));
        s.count = s.sold.length;
        if(s.count >= 200) { s.currentGiro = 1; s.isSpinning = true; s.endTime = Date.now() + 15000; }
        mySelection = [];
        db.ref('salas').set(salas);
    } else { alert("Saldo insuficiente"); }
}
function createRain() { const c = document.getElementById('rain-container'); for(let i=0; i<60; i++) { let p = document.createElement('div'); p.className = 'particle'; p.style.left = Math.random()*100+'vw'; p.style.animationDuration = (Math.random()*3+2)+'s'; c.appendChild(p); } }
</script>
</body>
</html>
